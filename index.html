<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>性能カスタム記録フォーム</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    .row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    label {
      width: 150px;
    }
    input[type="text"], select {
      width: 25%;
      padding: 4px;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 4px 8px;
      text-align: center;
    }
    .radio-group label {
      margin-right: 8px;
    }
    .checkbox-group {
      display: flex;
      gap: 12px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>性能カスタム記録フォーム</h2>

  <div id="g_id_onload"
    data-client_id="735792055029-5qb8bcm39qg7g8qrsh60di4pq87afos3.apps.googleusercontent.com"
    data-callback="onSignIn">
  </div>
  <div class="g_id_signin" data-type="standard"></div>

  <div id="form-area" style="display:none;">
    <div class="row">
      <label for="userName">記入者名:</label>
      <select id="userName" required></select>
    </div>
    <div class="row">
      <label for="vehicleNumber">車両番号:</label>
      <input type="text" id="vehicleNumber" required />
    </div>

    <table>
      <tr>
        <th>項目</th>
        <th colspan="5">選択</th>
      </tr>
      <tr>
        <td>エンジン</td>
        <td colspan="5" class="radio-group">
          <label><input type="radio" name="engine" value="1">ティア1</label>
          <label><input type="radio" name="engine" value="2">ティア2</label>
          <label><input type="radio" name="engine" value="3">ティア3</label>
          <label><input type="radio" name="engine" value="4">ティア4</label>
          <label><input type="radio" name="engine" value="5">ティア5</label>
        </td>
      </tr>
      <tr>
        <td>ブレーキ</td>
        <td colspan="3" class="radio-group">
          <label><input type="radio" name="brake" value="1">ティア1</label>
          <label><input type="radio" name="brake" value="2">ティア2</label>
          <label><input type="radio" name="brake" value="3">ティア3</label>
        </td>
      </tr>
      <tr>
        <td>トランスミッション</td>
        <td colspan="3" class="radio-group">
          <label><input type="radio" name="transmission" value="1">ティア1</label>
          <label><input type="radio" name="transmission" value="2">ティア2</label>
          <label><input type="radio" name="transmission" value="3">ティア3</label>
        </td>
      </tr>
      <tr>
        <td>サスペンション</td>
        <td colspan="4" class="radio-group">
          <label><input type="radio" name="suspension" value="1">ティア1</label>
          <label><input type="radio" name="suspension" value="2">ティア2</label>
          <label><input type="radio" name="suspension" value="3">ティア3</label>
          <label><input type="radio" name="suspension" value="4">ティア4</label>
        </td>
      </tr>
    </table>

    <div class="checkbox-group">
      <label><input type="checkbox" id="armor">アーマー</label>
      <label><input type="checkbox" id="turbo">ターボ</label>
      <label><input type="checkbox" id="harness">ハーネス</label>
      <label><input type="checkbox" id="nos">NOS</label>
    </div>

    <div style="margin-top:12px;">
      <button onclick="submitForm()">送信</button>
    </div>
  </div>

  <script>
    let userEmail = "";

    function onSignIn(response) {
      const idToken = response.credential;
      fetch('https://script.google.com/macros/s/AKfycbwQPVM_kgy-GCz95FNKpkVDmPWaTstVQi0zMN6vyb_5OZ29rnAyC3tjxXAa4baiZOyF/exec', {
        method: 'POST',
        body: JSON.stringify({ mode: 'verify', token: idToken }),
      })
      .then(res => res.json())
      .then(data => {
        if (data.allowed) {
          userEmail = data.email;
          const select = document.getElementById("userName");
          select.innerHTML = '';
          data.users.forEach(name => {
            const option = document.createElement("option");
            option.textContent = name;
            if (data.name === name) option.selected = true;
            select.appendChild(option);
          });
          document.getElementById("form-area").style.display = "block";
          document.querySelector(".g_id_signin").style.display = "none";
        } else {
          alert("アクセスが許可されていません");
        }
      });
    }

    function submitForm() {
      const payload = {
        mode: "submit",
        name: document.getElementById("userName").value,
        number: document.getElementById("vehicleNumber").value,
        engine: document.querySelector("input[name='engine']:checked")?.value || "",
        brake: document.querySelector("input[name='brake']:checked")?.value || "",
        transmission: document.querySelector("input[name='transmission']:checked")?.value || "",
        suspension: document.querySelector("input[name='suspension']:checked")?.value || "",
        armor: document.getElementById("armor").checked,
        turbo: document.getElementById("turbo").checked,
        harness: document.getElementById("harness").checked,
        nos: document.getElementById("nos").checked,
      };
      fetch('https://script.google.com/macros/s/AKfycbyT8DiQ3HDADEsDzptcA_i4k116fYfszL1IBMSfTq-7jOAMOLbWg-QDsoo8EcK3AJ3T/exec', {
        method: 'POST',
        body: JSON.stringify(payload),
      })
      .then(res => res.text())
      .then(msg => {
        alert("送信されました");
        location.reload();
      });
    }
  </script>
</body>
</html>
