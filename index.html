<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>性能カスタム記録フォーム</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    /* 既存デザインを維持 */
    body { font-family: sans-serif; margin: 2em; }
    .input-row { display: flex; align-items: center; margin-bottom: 0.5em; }
    label { width: 6em; display: inline-block; }
    input[type="text"], select { width: 200px; padding: 2px; }
    table { border-collapse: collapse; width: auto; }
    td, th { padding: 4px 8px; text-align: left; }
    .radio-group label, .checkbox-group label { margin-right: 10px; }
    .submit-btn { margin-top: 1em; }
    .search-section { margin-top: 2em; border-top: 1px solid #ccc; padding-top: 1em; }
    .results { margin-top: 1em; white-space: pre-wrap; font-family: monospace; }
  </style>
</head>
<body>
  <h2>性能カスタム記録フォーム</h2>

  <!-- ログインエリア -->
  <div id="login-area">
    <div id="g_id_onload"
      data-client_id="735792055029-5qb8bcm39qg7g8qrsh60di4pq87afos3.apps.googleusercontent.com"
      data-callback="handleCredentialResponse"
      data-auto_prompt="true">
    </div>
    <div class="g_id_signin" data-type="standard"></div>
  </div>

  <!-- フォーム & 検索（ログイン後に表示） -->
  <div id="main-area" style="display:none">
    <form id="customForm">
      <!-- フォーム内容は一切変更なし -->
      <!-- ... (そのままコピーしてください) ... -->
    </form>

    <div class="search-section">
      <h3>検索</h3>
      <div class="input-row">
        <label for="search">車両番号 or オーナー名</label>
        <input type="text" id="search">
        <button type="button" id="searchBtn">検索</button>
      </div>
      <div id="results" class="results"></div>
    </div>
  </div>

  <script>
    const form = document.getElementById("customForm");
    const mainArea = document.getElementById("main-area");
    const loginArea = document.getElementById("login-area");
    const recorderSelect = document.getElementById("recorder");
    const GAS_URL = "https://script.google.com/macros/s/AKfycbwWK8atUgk8dspEPleVGMemgE-iJuwXX701EjkSFQyAVeCsZtbFTOKOn2YWzNSSFfNt/exec"; // 実際のURLに差し替えてください

    function handleCredentialResponse(response) {
      fetch(`${GAS_URL}?mode=verify`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ id_token: response.credential })
      })
      .then(res => res.json())
      .then(data => {
        if (data.allowedNames) {
          // ログイン成功時にのみフォームと検索表示
          loginArea.style.display = "none";
          mainArea.style.display = "block";
          recorderSelect.innerHTML = "";
          data.allowedNames.forEach(name => {
            const opt = document.createElement("option");
            opt.value = opt.textContent = name;
            recorderSelect.appendChild(opt);
          });
        } else {
          alert("アクセス権がありません");
        }
      })
      .catch(() => alert("ログイン認証エラー"));
    }

    // 以降、submit と検索の fetch 処理はそのまま維持
  </script>
</body>
</html>
